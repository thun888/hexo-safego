<!DOCTYPE html>
<html lang="zh">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="robots" content="noindex, nofollow"/>
    <title>页面加载中，请稍候...</title>
    <style type="text/css">
        body {
            background: linear-gradient(135deg, #BFFFFF, #FFDDEE);
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        .loading {
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 18px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            animation: fadein 2s;
            width: 300px;
        }
        @keyframes fadein {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .content {
            margin-bottom: 20px;
        }
        .url-text, .countdown-text {
            margin-bottom: 10px;
            color: #333;
            font-size: 16px;
            letter-spacing: 1px;
        }
        .url-text span {
            color: red;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: normal;
        }
        .countdown-text {
            margin-top: 12px;
            font-size: 12px;
            color: #515151;
        }
        .button-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }
        .button {
            padding: 10px 20px;
            border-radius: 16px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            width: 120px;
            height: 40px;
        }
        .cancel-button {
            background-color: #80FFFF;
            color: black;
        }
        .confirm-button {
            background-color: #4a90e2;
            color: white;
        }
        .progress-bar {
            width: 100%;
            background-color: linear-gradient(135deg, #FF80FF, #00FFFF);
            border-radius: 5px;
            overflow: hidden;
            height: 10px;
            margin-top: 20px;
        }
        .progress {
            width: 100%;
            height: 100%;
            background-color: #4a90e2;
            transition: width 1s;
        }

        /* 黑色主题样式 */
        body.dark-mode {
            background: linear-gradient(135deg, #5B0000, #007777);
        }
        .loading.dark-mode {
            background: #4c4c4c;
            color: #EFEFEF;
            box-shadow: 0 4px 8px rgba(100, 100, 100, 0.1);
        }
        .loading.dark-mode .url-text, .loading.dark-mode .countdown-text {
            color: #EFEFEF;
        }
        .loading.dark-mode .cancel-button {
            background-color: #872C2C;
            color: #FFF;
        }
        .loading.dark-mode .confirm-button {
            background-color: #28566F;
            color: #FFF;
        }
        .loading.dark-mode .progress-bar {
            background-color: #444;
        }
        .loading.dark-mode .progress {
            background-color: #888;
        }
    </style>
    <script type="text/javascript">
        const host = window.location.host;

        function GetQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var r = window.location.search.substr(1).match(reg);
            return r ? decodeURI(r[2]) : null;
        }

        function base64Decode(input) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
            let str = input.replace(/=+$/, '');
            let output = '';

            if (str.length % 4 == 1) {
                throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");
            }
            for (let bc = 0, bs, buffer, idx = 0; buffer = str.charAt(idx++); ~buffer && (bs = bc % 4 ? bs * 64 + buffer : buffer, bc++ % 4) ? output += String.fromCharCode(255 & bs >> (-2 * bc & 6)) : 0) {
                buffer = chars.indexOf(buffer);
            }
            return output;
        }

        var jump_url = GetQueryString('{{url_param_name}}');
        {% if(enable_base64_encode) %}
        jump_url = base64Decode(jump_url);
        {% endif %}
        var UrlReg = '^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)';
        if (!jump_url || !jump_url.match(UrlReg)) {
            document.title = '参数错误，正在返回首页...';
            jump_url = location.origin;
        }

        let countdown = 5;
        let progressElement;
        let countdownElement;
        let jumpUrlElement;

        function updateCountdown() {
            countdownElement.textContent = countdown;
            progressElement.style.width = (countdown / 5 * 100) + '%';
            if (countdown === 0) {
                jump();
            } else {
                countdown--;
                setTimeout(updateCountdown, 1000);
            }
        }

        function jump() {
            {% if (safety_chain) %}
            if (document.location.hostname !== 'localhost' && document.location.hostname !== '{{domain}}') {
                location.href = '//' + host;
                return;
            }
            {% endif %}
            location.href = jump_url;
        }

        function closeWindow() {
            window.opener = null;
            window.close();
        }

        function applyDarkMode() {
            var hour = new Date().getHours();
            if (hour >= 18 || hour < 6) {
                document.body.classList.add('dark-mode');
                document.querySelector('.loading').classList.add('dark-mode');
            }
        }

        window.onload = function() {
            applyDarkMode();
            progressElement = document.getElementById('progress');
            countdownElement = document.getElementById('countdown');
            jumpUrlElement = document.getElementById('jump-url');

            jumpUrlElement.textContent = jump_url;
            updateCountdown();
        }
    </script>
</head>
<body>
    <div class="loading">
        <div class="content">
            <div class="url-text">即将跳转到：<span id="jump-url"></span></div>
        </div>
        <div class="countdown-text">将在 <span id="countdown">5</span> 秒后跳转</div>
        <div class="progress-bar">
            <div class="progress" id="progress"></div>
        </div>
        <div class="button-container">
            <button class="button cancel-button" onclick="closeWindow()">取消跳转</button>
            <button class="button confirm-button" onclick="jump()">立即跳转</button>
        </div>
    </div>
</body>
</html>
